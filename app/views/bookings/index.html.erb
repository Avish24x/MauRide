<div class="section">
  <%= link_to root_path,data: {turbo_method: :get} do %>
      <i class="fa-solid fa-arrow-left fa-xl" style="color: #000000;"></i>
    <% end %><hr>
  <h2>My bookings</h2>
</div>

  <%# on tri les bookings des rides pas encore passÃ© avant, puis ceux finis %>
  <% sorted_bookings = @bookings.to_a.sort_by {|booking| booking.ride.start_time }.reverse %>
  <% previews_rides = [] %>
  <% futurs_rides = [] %>

  <% sorted_bookings.each do |booking| %>
    <% if Time.now > booking.ride.start_time %>
      <% previews_rides << booking %>
    <% else %>
      <% futurs_rides << booking %>
    <% end %>
  <% end %>

<div>
  <div class="section-blanche" >
    <h2>Rides to come</h2>
  </div>

  <% futurs_rides.each do |booking| %>
    <div class="notification card-rides" >
      <div class="notification-content">
        <p><strong><%= booking.ride.start_time.strftime("%-d %b %Y, %H:%M") %></strong></p>
        <p><strong> <%= booking.ride.start_location.address %> <i class="fa-solid fa-arrow-right"></i> <%= booking.ride.end_location.address %></strong></p><hr>

        <div class="space_between">
          <p><%= booking.booked_seats %> seats</p>
          <p><i class="fa-solid fa-rupee-sign"></i> <strong><%= booking.total_price %></strong></p>
        </div>

        <hr><div class="space_between">
          <p>With <%= booking.ride.vehicule.user.first_name %> <%= booking.ride.vehicule.user.last_name %> <%= cl_image_tag booking.ride.vehicule.user.photo.key, width: 50, height: 50, crop: :thumb, gravity: :face, radius: :max %></p>

          <%= link_to booking_path(booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
          <p>Cancel booking <i class="far fa-trash-alt"></i></p>
          <% end %><hr>
        </div>
      </div>
    </div>
  <% end %>

  <div class="section-blanche" >
    <h2>Previous rides</h2>
  </div>

 <% previews_rides.each do |booking| %>
    <div class="notification card-rides" >
      <div class="notification-content">
        <p><strong><%= booking.ride.start_time.strftime("%-d %b %Y, %H:%M") %></strong></p>
        <p><strong> <%= booking.ride.start_location.address %> <i class="fa-solid fa-arrow-right"></i> <%= booking.ride.end_location.address %></strong></p><hr>

        <div class="space_between">
          <p><%= booking.booked_seats %> seats</p>
          <p><i class="fa-solid fa-rupee-sign"></i> <strong><%= booking.ride.price %></strong></p>
        </div>

        <hr><div class="space_between">
          <div class="popup-review">
            <p>With <%= booking.ride.vehicule.user.first_name %> <%= booking.ride.vehicule.user.last_name %> <%= cl_image_tag booking.ride.vehicule.user.photo.key, width: 50, height: 50, crop: :thumb, gravity: :face, radius: :max %></p>
                  <%= link_to ride_path(booking.ride),data: {turbo_method: :get} do %>
                  <p>Add a rating <i class="fa-solid fa-circle-plus fa-xl" style="color: #670bff;" onclick="openPopuptwo()"></i></p>

            <% end %><hr>

            <div class="popuptwo" id="popuptwo">
              <%= image_tag "tick.png" %>
              <h2>Add a Review</h2>
              <p>Your payment has been confirmed succesfully</p>
              <button onclick="closePopuptwo()">Confirm</button>
           </div>

            <script>
              let popuptwo = document.getElementById("popuptwo");

              function openPopuptwo(params) {
                popup.classList.add("open-popuptwo");
              }
              function closePopuptwo(params) {
                popup.classList.remove("open-popuptwo");
              }
            </script>
          </div>
        </div>

      </div>
      </div>
    </div>
  <% end %>
</div>
