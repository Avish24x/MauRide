<div class="section">
  <%= link_to rides_path,
    data: {turbo_method: :get} do %>
      <i class="fa-solid fa-arrow-left fa-xl" style="color: #000000;"></i>
    <% end %><hr>
  <h2>Ride</h2>
</div>

<div class="notification">
  <div style="width: 100%; height: 400px;"
    data-controller="map"
    data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
</div>

<div class="notification user-edit-card">
  <div class="notification-content-rides">
    <h2><strong><%= @ride.start_location.address%></strong> <i class="fa-solid fa-arrow-right"></i> <strong><%= @ride.end_location.address%></strong></h2>
    <p><strong>Start time : </strong><%= @ride.start_time.strftime("%-d %b %Y, %H:%M") %></p>
    <p><strong>End time : </strong><%= @ride.end_time.strftime("%-d %b %Y, %H:%M") %></p>
    <p><strong>Price : </strong>Rs <%= @ride.price %></p>
    <p><strong>Details : </strong><%= @ride.ride_details %></p>

    <%# on affiche la photo du driver pour acceder Ã  son profil %>
    <p><%= link_to user_path(@ride.vehicule.user),
      data: {turbo_method: :get} do %>
      <%= cl_image_tag @ride.vehicule.user.photo.key, width: 56, height: 56, crop: :thumb, gravity: :face, radius: :max %>
    <% end %></p>

    <% if Time.now <= @ride.start_time %>

      <%= simple_form_for [@ride, @booking] do |form| %>
        <%= form.error_notification %>
        <%= form.input :booked_seats, label: "How many seats ?", collection: (1..@ride.seats) %>
        <%= form.button :submit, "Book now", class: "btn btn-flat" %>
      <% end %>

      <div class="notification-actions">
        <% if current_user == @ride.vehicule.user %>
          <%= link_to ride_path(@ride),
          data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
            <i class="far fa-trash-alt"></i>
          <% end %><hr>
        <% end %>
      </div>
  </div>
</div>
    <% else%>
      <div class="notification user-edit-card">
        <div class="notification-content">
          <h2 class="review-ride-title"><strong>Add Review</strong></h2>
          <%= simple_form_for [@ride, @review] do |f| %>
            <%= f.input :rating, collection: (1..5).to_a, label: "Rate your experience", input_html: {data: {controller: "star-rating"}} %>
            <%= f.input :comment %>
            <%= f.submit class: "btn btn-flat" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
